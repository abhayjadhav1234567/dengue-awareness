<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dengue Awareness Project</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
  <script src="https://unpkg.com/globe.gl"></script>
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    :root{--accent:#f94144;--accent2:#ff7b00;--card:#fff;--muted:#556;}
    body{font-family:Inter,Arial;margin:0;background:linear-gradient(180deg,#f7fbff,#e8f0ff);color:#17324d}
    header{padding:28px;text-align:center}
    header h1{margin:0;color:var(--accent)}
    .keywords{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-top:12px}
    .kw{background:#fff;padding:10px 14px;border-radius:12px;cursor:pointer;box-shadow:0 8px 24px rgba(16,24,40,0.06)}
    .container{max-width:1100px;margin:20px auto;padding:0 16px}
    .grid{display:grid;grid-template-columns:2fr 1fr;gap:18px}
    .card{background:#fff;padding:16px;border-radius:12px;box-shadow:0 10px 30px rgba(16,24,40,0.06)}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
    th{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff}
    .charts{display:flex;gap:12px;flex-wrap:wrap}
    .chart-box{flex:1;min-width:260px;background:linear-gradient(180deg,#fff,#fbfdff);padding:8px;border-radius:10px}
    #globeViz{height:420px;border-radius:10px;margin-top:8px}
    #indiaMap{height:480px;border-radius:10px;margin-top:12px}
    footer{text-align:center;padding:12px;color:#6b7a8a}
    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  </style>
</head>
<body>
<header>
  <h1>Dengue Awareness Project</h1>
  <p class="muted">Interactive visuals for 2021–2025 (top states) — Data: NVBDCP</p>
  <div class="keywords">
    <div class="kw" onclick="document.getElementById('what').scrollIntoView({behavior:'smooth'})">What is Dengue?</div>
    <div class="kw" onclick="document.getElementById('symptoms').scrollIntoView({behavior:'smooth'})">Symptoms</div>
    <div class="kw" onclick="document.getElementById('prevention').scrollIntoView({behavior:'smooth'})">Prevention</div>
    <div class="kw" onclick="document.getElementById('visuals').scrollIntoView({behavior:'smooth'})">Visuals</div>
  </div>
</header>

<div class="container">
  <div id="what" class="card">
    <h2 style="color:var(--accent)">What is Dengue?</h2>
    <p>Dengue is a mosquito-borne viral disease. Severe dengue can cause bleeding, shock, and death. This site shows official NVBDCP counts for states (2021–2025).</p>
  </div>

  <div class="grid" style="margin-top:16px">
    <div class="card">
      <h2 style="color:var(--accent)">Interactive Visuals</h2>
      <div class="controls">
        <label for="yearSelect">Choose year:</label>
        <select id="yearSelect"></select>

        <label for="topN">Top N states:</label>
        <select id="topN">
          <option value="6">Top 6</option>
          <option value="8" selected>Top 8</option>
          <option value="11">Top 11</option>
          <option value="36">All States</option>
        </select>
      </div>

      <div class="controls" style="margin:8px 0;">
        <label for="viewMode">View Mode:</label>
        <select id="viewMode">
          <option value="casesdeaths" selected>Cases & Deaths</option>
          <option value="cfr">CFR (%)</option>
        </select>
      </div>

      <div class="charts" style="margin-top:12px">
        <div class="chart-box">
          <h4 class="small">Cases share (pie)</h4>
          <canvas id="pieChart"></canvas>
        </div>
        <div class="chart-box">
          <h4 class="small">Cases & Deaths trend (line)</h4>
          <canvas id="lineChart"></canvas>
        </div>
      </div>

      <h4 style="margin-top:12px">India Map (cases by state)</h4>
      <div id="indiaMap"></div>

      <h4 style="margin-top:12px">3D Globe: size = cases, color = deaths</h4>
      <div id="globeViz"></div>
    </div>

    <div class="card" id="details">
      <h3 style="color:var(--accent)">Top States Data (2021–2025)</h3>
      <div id="tableWrap"></div>
      <p class="small muted" style="margin-top:8px">Source: NCVBDC / NVBDCP — DENGUE SITUATION IN INDIA</p>
    </div>
  </div>

  <footer>
    <p>© 2025 Dengue Awareness Project — Classroom presentation</p>
  </footer>
</div>

<script src="dengue_data_nvbdcp_top_states.js"></script>
<script>
const years = ["2021","2022","2023","2024","2025"];
let pieChart,lineChart,globe,myMap,geoLayer;

function populateYearSelect(){
  const sel=document.getElementById('yearSelect');
  years.forEach(y=>{
    const opt=document.createElement('option');
    opt.value=y; opt.textContent=y;
    sel.appendChild(opt);
  });
  sel.value="2024";
  sel.addEventListener('change', updateVisuals);
  document.getElementById('topN').addEventListener('change', updateVisuals);
  document.getElementById('viewMode').addEventListener('change', updateVisuals);
}

function getTopStatesByYear(year,N){
  const arr=window.dengueStateData.map(s=>({state:s.state,cases:s.values[year].cases,deaths:s.values[year].deaths,values:s.values,lat:s.lat,lng:s.lng}));
  arr.sort((a,b)=>b.cases-a.cases);
  return arr.slice(0,N);
}

function buildPie(year,N){
  const top=getTopStatesByYear(year,N);
  const ctx=document.getElementById('pieChart').getContext('2d');
  if(pieChart) pieChart.destroy();
  pieChart=new Chart(ctx,{type:'pie',data:{labels:top.map(t=>t.state),datasets:[{data:top.map(t=>t.cases)}]},options:{plugins:{legend:{position:'bottom'}}}});
}

function buildLine(N,viewMode){
  const ctx=document.getElementById('lineChart').getContext('2d');
  if(lineChart) lineChart.destroy();
  const topStates=getTopStatesByYear("2024",N).map(t=>t.state);
  if(viewMode==='cfr'){
    const datasets=topStates.map(s=>{
      const obj=window.dengueStateData.find(d=>d.state===s);
      return{label:s+" CFR%",data:years.map(y=>obj.values[y].cases>0?(obj.values[y].deaths/obj.values[y].cases*100).toFixed(2):0),tension:0.3};
    });
    lineChart=new Chart(ctx,{type:'line',data:{labels:years,datasets},options:{plugins:{legend:{position:'bottom'}},scales:{y:{title:{display:true,text:'CFR %'}}}}});
  } else {
    const datasets=topStates.map(s=>{
      const obj=window.dengueStateData.find(d=>d.state===s);
      return{label:s+" cases",data:years.map(y=>obj.values[y].cases),tension:0.3,yAxisID:'y'};
    });
    const deathDatasets=topStates.map(s=>{
      const obj=window.dengueStateData.find(d=>d.state===s);
      return{label:s+" deaths",data:years.map(y=>obj.values[y].deaths),borderDash:[5,3],tension:0.3,yAxisID:'yDeaths'};
    });
    lineChart=new Chart(ctx,{type:'line',data:{labels:years,datasets:[...datasets,...deathDatasets]},options:{interaction:{mode:'index',intersect:false},stacked:false,plugins:{legend:{position:'bottom'}},scales:{y:{type:'linear',position:'left',title:{display:true,text:'Cases'}},yDeaths:{type:'linear',position:'right',title:{display:true,text:'Deaths'},grid:{drawOnChartArea:false}}}}});
  }
}

function buildTable(N){
  const top=getTopStatesByYear("2024",N);
  const wrap=document.getElementById('tableWrap');
  wrap.innerHTML='';
  const tbl=document.createElement('table');
  tbl.innerHTML='<thead><tr><th>State</th>'+years.map(y=>`<th>${y} (C/D)</th>`).join('')+'</tr></thead>';
  const tbody=document.createElement('tbody');
  top.forEach(s=>{
    const row=document.createElement('tr');
    row.innerHTML=`<td>${s.state}</td>`+years.map(y=>`<td>${s.values[y].cases}/${s.values[y].deaths}</td>`).join('');
    tbody.appendChild(row);
  });
  tbl.appendChild(tbody);
  wrap.appendChild(tbl);
}

function buildIndiaMap(year,N){
  if(!myMap){
    myMap=L.map('indiaMap').setView([22.5,80],4.5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'© OpenStreetMap'}).addTo(myMap);
  }
  if(geoLayer) myMap.removeLayer(geoLayer);

  fetch("india_states.json")
    .then(r=>r.json())
    .then(geojson=>{
      const top=getTopStatesByYear(year,N);
      const stateData={};
      top.forEach(d=>{stateData[d.state]={cases:d.cases,deaths:d.deaths};});
      function style(feature){
        const d=stateData[feature.properties.st_nm];
        return {
          fillColor:d?getColor(d.cases):'#ccc',
          weight:1,opacity:1,color:'white',dashArray:'3',fillOpacity:0.7
        };
      }
      function getColor(c){return c>30000?'#800026':c>20000?'#BD0026':c>10000?'#E31A1C':c>5000?'#FC4E2A':c>1000?'#FD8D3C':c>500?'#FEB24C':c>100?'#FED976':'#FFEDA0';}
      function onEachFeature(feature,layer){
        const d=stateData[feature.properties.st_nm];
        if(d){layer.bindPopup(`<b>${feature.properties.st_nm}</b><br>Cases: ${d.cases}<br>Deaths: ${d.deaths}`);}
      }
      geoLayer=L.geoJson(geojson,{style:onEachFeature,onEachFeature:onEachFeature}).addTo(myMap);
    });
}

function buildGlobe(year,N){
  const top=getTopStatesByYear(year,N);
  const points=top.map(d=>({
    lat:d.lat,lng:d.lng,
    size:Math.max(0.2,Math.log(d.cases+1)/3),
    color:d.deaths>10?'rgba(244,65,68,0.9)':(d.deaths>2?'rgba(255,160,70,0.9)':'rgba(100,200,120,0.9)'),
    name:d.state,cases:d.cases,deaths:d.deaths
  }));
  if(!globe){
    globe=Globe()(document.getElementById('globeViz'))
      .globeImageUrl('//unpkg.com/three-globe/example/img/earth-night.jpg')
      .pointsData(points).pointAltitude('size').pointColor('color')
      .pointLabel(p=>`${p.name}<br>Cases: ${p.cases}<br>Deaths: ${p.deaths}`);
  } else {
    globe.pointsData(points);
  }
}

function updateVisuals(){
  const year=document.getElementById('yearSelect').value;
  const N=parseInt(document.getElementById('topN').value,10);
  buildPie(year,N);
  buildLine(N,document.getElementById('viewMode').value);
  buildTable(N);
  buildIndiaMap(year,N);
  buildGlobe(year,N);
}

populateYearSelect();
updateVisuals();
</script>
</body>
</html>
