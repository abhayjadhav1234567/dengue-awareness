<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Dengue Awareness</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="data:,">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script type="module" src="https://cdn.jsdelivr.net/npm/globe.gl@2.31.1/dist/globe.gl.min.js"></script>
</head>
<body>
<header class="site-header">
  <div class="title-wrap">
    <div class="mosquitoes" aria-hidden="true">
      <div class="mosq mosq1"></div>
      <div class="mosq mosq2"></div>
      <div class="mosq mosq3"></div>
    </div>
    <h1 id="siteTitle">Dengue Awareness</h1>
  </div>
  <div class="nav">
    <button data-target="definition">What is Dengue?</button>
    <button data-target="symptoms">Symptoms</button>
    <button data-target="prevention">Prevention</button>
    <button data-target="treatment">Treatment</button>
    <button data-target="visuals">Visuals of Data</button>
  </div>
</header>

<main>
  <section id="definition" class="card">
    <h2>What is Dengue?</h2>
    <p>Dengue is a mosquito-borne viral infection caused by the bite of the Aedes aegypti mosquito. Severe dengue can be life-threatening.</p>
  </section>

  <section id="symptoms" class="card">
    <h2>Symptoms</h2>
    <ul>
      <li>High fever</li>
      <li>Severe headache</li>
      <li>Muscle and joint pains</li>
      <li>Nausea and vomiting</li>
      <li>Skin rash (2–5 days)</li>
    </ul>
  </section>

  <section id="prevention" class="card">
    <h2>Prevention</h2>
    <ul>
      <li>Use mosquito repellents and nets</li>
      <li>Eliminate stagnant water</li>
      <li>Wear protective clothing</li>
      <li>Community awareness</li>
    </ul>
  </section>

  <section id="charts" class="card">
    <h2>Visuals — Charts</h2>
    <div class="charts-row">
      <div class="chart-box small"><canvas id="pieChart"></canvas></div>
      <div class="chart-box large"><canvas id="barChart"></canvas></div>
    </div>
    <div class="line-chart"><canvas id="lineChart"></canvas></div>
    <div class="controls">
      <label for="yearSelect">Select Year:</label>
      <select id="yearSelect"></select>
      <label for="viewSelect">View:</label>
      <select id="viewSelect"><option value="cases">Cases</option><option value="deaths">Deaths</option></select>
    </div>
  </section>

  <!-- 🌍 Updated Space Earth Section -->
  <section id="visuals" class="card">
    <h2>Visuals of Data</h2>
    <div id="globeContainer" style="height:600px"></div>
  </section>

  <section id="final" class="card center">
    <button id="endBtn" class="end-btn">🎥 End Presentation</button>
    <div id="goodbye" class="goodbye"><span>🦟 Take care of yourself</span></div>
  </section>
</main>

<footer class="site-footer"><p>© 2025 Dengue Awareness</p></footer>

<script src="data.js"></script>

<!-- Smooth Section Scroll -->
<script>
document.querySelectorAll('.nav button').forEach(b=>{
  b.addEventListener('click',()=>{document.getElementById(b.getAttribute('data-target')).scrollIntoView({behavior:'smooth'});});
});
</script>

<!-- 🦟 Mosquito Animation -->
<script>
function createMosqMotion(className, speed, radiusX, radiusY, phase){
  const el=document.querySelector(className);let t=phase;
  function step(){t+=speed;
    const x=50+radiusX*Math.cos(t);const y=10+radiusY*Math.sin(2*t);
    el.style.transform=`translate(${x}px,${y}px) rotate(${8*Math.sin(3*t)}deg)`;
    requestAnimationFrame(step);}
  step();
}
createMosqMotion('.mosq1',0.012,40,8,0);
createMosqMotion('.mosq2',0.016,55,10,1.2);
createMosqMotion('.mosq3',0.009,30,6,2.1);
</script>

<!-- 📊 Charts -->
<script>
availableYears.forEach(y=>{
  const o=document.createElement('option');o.value=y;o.textContent=y;
  document.getElementById('yearSelect').appendChild(o);
});
document.getElementById('yearSelect').value=Math.max(...availableYears);
let pieChart,barChart,lineChart;
function drawAll(year){
  const y=String(year);
  const entries=Object.keys(dengueDataAllStates).map(s=>({state:s,...dengueDataAllStates[s][y]}));
  entries.sort((a,b)=>b.cases-a.cases);
  const top10=entries.slice(0,10);
  const labels=top10.map(e=>e.state),vals=top10.map(e=>e.cases);
  const pctx=document.getElementById('pieChart').getContext('2d');
  if(pieChart) pieChart.destroy();
  pieChart=new Chart(pctx,{type:'doughnut',data:{labels,datasets:[{data:vals}]}});
  const years=availableYears;
  const sums=years.map(y=>Object.values(dengueDataAllStates).reduce((a,s)=>a+s[y].cases,0));
  const bctx=document.getElementById('barChart').getContext('2d');
  if(barChart) barChart.destroy();
  barChart=new Chart(bctx,{type:'bar',data:{labels:years.map(String),datasets:[{data:sums}]}});
  const deaths=years.map(y=>Object.values(dengueDataAllStates).reduce((a,s)=>a+s[y].deaths,0));
  const lctx=document.getElementById('lineChart').getContext('2d');
  if(lineChart) lineChart.destroy();
  lineChart=new Chart(lctx,{type:'line',data:{labels:years.map(String),datasets:[{data:deaths,borderColor:'#e74c3c'}]}});
}
drawAll(Math.max(...availableYears));
document.getElementById('yearSelect').addEventListener('change',()=>drawAll(yearSelect.value));
</script>

<!-- 🌍 3D Space Earth with Stars -->
<script type="module">
import Globe from "https://cdn.jsdelivr.net/npm/globe.gl@2.31.1/dist/globe.gl.min.js";
const globeEl=document.getElementById("globeContainer");
const world=Globe()(globeEl)
  .globeImageUrl("https://unpkg.com/three-globe/example/img/earth-night.jpg")
  .showAtmosphere(true)
  .atmosphereColor("lightblue")
  .atmosphereAltitude(0.25)
  .backgroundImageUrl("https://unpkg.com/three-globe/example/img/night-sky.png")
  .autoRotate(true)
  .autoRotateSpeed(0.25)
  .pointAltitude("size")
  .pointColor("color");

fetch("india_states_full.json").then(r=>r.json()).then(g=>{
  const make=(year,view)=>g.features.map(f=>{
    const st=f.properties.name;
    const v=dengueDataAllStates[st][String(year)][view];
    const color=view==="deaths"?
      (v>60?"#000":v>30?"#333":"#777"):
      (v>15000?"#7f0000":v>8000?"#d93b3b":"#ff9b9b");
    return {lat:f.geometry.coordinates[1],lng:f.geometry.coordinates[0],size:Math.log10(v+1)*0.25,color,name:st,val:v};
  });
  const update=()=>world.pointsData(make(yearSelect.value,viewSelect.value));
  update();
  yearSelect.addEventListener("change",update);
  viewSelect.addEventListener("change",update);
});
window.addEventListener("load",()=>{
  const globe=document.querySelector("#globeContainer canvas");
  if(globe){globe.style.transform="scale(0.7)";globe.style.transition="transform 2s ease";setTimeout(()=>{globe.style.transform="scale(1)";},100);}
});
</script>

<!-- 🎬 DOT Outro -->
<script>
const endBtn=document.getElementById('endBtn');
const goodbye=document.getElementById('goodbye');
endBtn.addEventListener('click',()=>{
  document.body.classList.add('dim');
  for(let i=0;i<3;i++){
    const el=document.createElement('div');
    el.className='mosq fly'+i;
    document.body.appendChild(el);
    setTimeout(()=>el.classList.add('toCenter'),50+i*300);
    setTimeout(()=>{el.classList.add('fadeout');setTimeout(()=>el.remove(),2000);},5000);
  }
  goodbye.classList.add('show');
  setTimeout(()=>{goodbye.classList.remove('show');document.body.classList.remove('dim');},5200);
});
</script>
</body>
</html>

